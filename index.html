<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <title>BNAPP V3.5.2</title>

  <meta name="theme-color" content="#ffffff" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="favicon.ico" />

  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  
<script defer src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  
  <!-- ✅ Hebcal (global Hebcal) - no geolocation -->
  <script src="https://cdn.jsdelivr.net/npm/hebcal@2.3.2/client/hebcal.noloc.min.js" crossorigin="anonymous"></script>

  <!-- App -->
  <script type="module" src="app.js"></script>
</head>

<body>
  <!-- Toast -->
  <div id="toast" class="toast hidden">בוצע</div>

  <div id="app">
    <header class="app-header">
      <div class="header-top">
        <button id="btnThemeToggle" class="icon-btn" title="מצב יום/לילה">☀️/🌙</button>
        <div class="app-title">BNAPP V3.5.2</div>
        <button id="btnGihari" class="primary-pill">ג'יחרי</button>
      </div>

      <div class="header-bottom">
        <button id="btnPrevMonth" class="icon-btn">‹</button>
        <div class="month-label">
          <span id="gregMonthLabel"></span>
          <span id="hebrewMonthLabel" class="sub-label"></span>
        </div>
        <button id="btnNextMonth" class="icon-btn">›</button>
      </div>

      <div class="header-row">
        <select id="userSelect" class="pill-select" title="משתמש">
          <option value="binyamin">בנימין</option>
          <option value="nana">ננה</option>
          <option value="shared">משותף</option>
        </select>
        <button id="btnToday" class="ghost-pill">היום</button>
        <button id="btnCity" class="ghost-pill">
          עיר: <span id="cityLabel">לא נבחרה</span>
        </button>
      </div>
    </header>

    <main>
      <section id="calendarSection" class="screen active">
        <div class="weekday-row">
          <div>א'</div><div>ב'</div><div>ג'</div><div>ד'</div><div>ה'</div><div>ו'</div><div>ש'</div>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
      </section>

      <section id="tasksSection" class="screen">
        <div class="section-header">
         <h2>משימות / אירועים</h2>
        <button id="btnAddTask" class="primary-pill">+ משימה / אירוע</button>
        </div>
      <div class="segmented">
  <!-- משימות -->
  <button data-filter="undated" class="segmented-btn active">משימות ללא תאריך</button>
  <button data-filter="dated" class="segmented-btn">משימות מתוארכות</button>
  <button data-filter="recurring" class="segmented-btn">משימות חוזרות</button>

  <!-- אירועים -->
  <button data-filter="dated-events" class="segmented-btn">אירועים מתוארכים</button>
  <button data-filter="recurring-events" class="segmented-btn">אירועים חוזרים</button>
</div>
        <div id="tasksList" class="list-container"></div>
      </section>

      <section id="shoppingSection" class="screen">
        <div class="section-header">
          <h2>רשימת קניות</h2>
        </div>
        <div class="segmented">
          <button data-list="default" class="segmented-btn active">רגיל</button>
          <button data-list="shabbat" class="segmented-btn">קניות לשבת</button>
          <button data-list="pesach" class="segmented-btn">קניות לפסח</button>
          <button data-list="holiday" class="segmented-btn">קניות לחג</button>
        </div>
        <div class="shopping-input-row">
          <input id="shoppingInput" type="text" placeholder="הוסף פריט..." />
          <button id="btnAddShopping" class="primary-pill">+</button>
        </div>
        <ul id="shoppingList" class="list-container"></ul>
      </section>

      <section id="statsSection" class="screen">
        <div class="section-header">

          <button id="btnOpenGoals" class="ghost-pill small">
  🎯 מטרות
</button>


<div id="statsRangeSelector">
  <button class="segmented-btn active" data-range="day">יומי</button>
  <button class="segmented-btn" data-range="week">שבועי</button>
  <button class="segmented-btn" data-range="2weeks">שבועיים</button>
  <button class="segmented-btn" data-range="month">חודשי</button>
  <button class="segmented-btn" data-range="year">שנתי</button>
</div>
          
          <h2>סטטיסטיקות</h2>
        </div>
        <div class="card">
          <canvas id="workFreeChart" height="220"></canvas>
        </div>
        <div class="card">
          <canvas id="tasksChart" height="220"></canvas>
        </div>

<div class="card" style="margin-bottom:12px">
  <div class="grid-2">
    <div class="field">
      <label>מתאריך</label>
      <input type="date" id="completedFromDate">
    </div>
    <div class="field">
      <label>עד תאריך</label>
      <input type="date" id="completedToDate">
    </div>
  </div>
</div>

<div id="statsCompleted"></div>

        


        
      </section>

      <section id="settingsSection" class="screen">
        <div class="section-header">
          <h2>הגדרות</h2>
        </div>

        <div class="settings-group">
          <label>עיר:</label>
          <input id="settingsCityInput" type="text" placeholder="Jerusalem,IL" />
          <button id="btnSaveCity" class="primary-pill">שמור עיר</button>
        </div>

        
        <div class="settings-group">
          <button id="btnRequestNotifications" class="ghost-pill full-width">הפעל התראות</button>
        </div>
      </section>
    </main>

    <nav class="bottom-nav">
      <button data-target="calendarSection" class="nav-btn active">לוח שנה</button>
    <button data-target="tasksSection" class="nav-btn">משימות / אירועים</button>
      <button data-target="shoppingSection" class="nav-btn">קניות</button>
      <button data-target="statsSection" class="nav-btn">סטטיסטיקות</button>
      <button data-target="settingsSection" class="nav-btn">הגדרות</button>
    </nav>

    <button id="btnFabAdd" class="fab-btn">+</button>
  </div>

  <!-- ===================== -->
  <!-- Day Modal -->
  <!-- ===================== -->
  <div id="dayModal" class="modal hidden">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content day-modal">
      <div class="modal-header">
        <div>
          <div class="modal-title">יום <span id="dayModalGreg"></span></div>
          <div class="modal-subtitle"><span id="dayModalHeb"></span></div>
        </div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <div id="dayWeatherContainer" class="weather-card hidden">
        <div class="weather-main">
          <div id="dayWeatherEmoji" class="weather-emoji">🌦️</div>
          <div>
            <div id="dayWeatherTemp" class="weather-temp">--</div>
            <div id="dayWeatherDesc" class="weather-desc"></div>
          </div>
        </div>
        <div id="dayWeatherExtra" class="weather-extra"></div>
      </div>

      <div class="task-actions">
        <button id="btnAddFromDay" class="primary-pill">+ הוסף</button>
        <button id="btnToggleDayWeather" class="ghost-pill small">מזג אוויר</button>
      </div>

      <div id="dayAutoBlocks" class="auto-blocks"></div>
      <div id="dayEventsContainer" class="list-container"></div>
    </div>
  </div>

  <!-- ===================== -->
  <!-- Edit Modal -->
  <!-- ===================== -->
  <div id="editModal" class="modal hidden">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">אירוע / משימה</div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <form id="editForm" class="form">
        <div class="grid-2">
          <div class="field">
            <label>סוג</label>
            <select name="type">
              <option value="event">אירוע</option>
              <option value="task">משימה</option>
            </select>
          </div>
          <div class="field">
            <label>שייך ל</label>
            <select name="owner">
              <option value="binyamin">בנימין</option>
              <option value="nana">ננה</option>
              <option value="shared">משותף</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>כותרת</label>
          <input name="title" required placeholder="לדוגמה: עבודה / אימון / רופא" />
        </div>

        <div class="field">
          <label>תיאור</label>
          <textarea name="description" rows="2" placeholder="אופציונלי"></textarea>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>תאריך (YYYY-MM-DD)</label>
           <input name="date" type="date" />
          </div>
          <div class="field">
            <label>דחיפות</label>
            <select name="urgency">
              <option value="none">לא דחוף</option>
              <option value="today">היום</option>
              <option value="week">השבוע</option>
              <option value="month">החודש</option>
            </select>
          </div>
        </div>

       <div class="grid-2">
  <div class="field">
    <label>שעת התחלה</label>
    <input type="time" name="startTime" />
  </div>
  <div class="field">
    <label>שעת סיום</label>
    <input type="time" name="endTime" />
  </div>
</div>

        <div class="grid-2">
          <div class="field">
            <label>משך (דקות)</label>
            <input name="duration" type="number" min="0" placeholder="30" />
          </div>
          <div class="field">
            <label>תזכורת (דקות לפני)</label>
            <input name="reminderMinutes" type="number" min="0" placeholder="15" />
          </div>
        </div>

        <div class="field">
          <label>כתובת (Waze)</label>
          <input name="address" placeholder="רחוב, עיר" />
          <div class="task-actions">
            <button id="btnOpenWaze" type="button" class="ghost-pill small">פתח Waze</button>
          </div>
        </div>

        <div class="field">
          <label>חזרה</label>
          <select name="recurring">
            <option value="none">ללא</option>
            <option value="weekly">שבועי</option>
            <option value="monthly_greg">חודשי (לועזי)</option>
            <option value="yearly_greg">שנתי (לועזי)</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="submit" class="primary-pill full-width">שמור</button>
        </div>
      </form>
    </div>
  </div>

<!-- ===================== -->
<!-- Conflict Modal -->
<!-- ===================== -->

  <!-- ===================== -->
  <!-- Gihari Modal -->
  <!-- ===================== -->
  <div id="gihariModal" class="modal hidden">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ג'יחרי</div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <div id="gihariSummary" class="gihari-summary"></div>

      <div class="gihari-actions">
        <button id="gihariMicBtn" class="primary-pill">🎤 דבר</button>
        <button id="btnGihariSuggestNow" class="ghost-pill">הצעה עכשיו</button>
        <button id="btnGihariPlaceTasks" class="ghost-pill">שבץ משימות ללא תאריך</button>
      </div>

      <div id="gihariLog" class="list-container"></div>
    </div>
  </div>

  <!-- ===================== -->
  <!-- Postpone Modal -->
  <!-- ===================== -->
  <div id="postponeModal" class="modal hidden">
    <div class="modal-backdrop" data-close-postpone></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">דחיית משימה</div>
        <button class="icon-btn" data-close-postpone>✕</button>
      </div>
     <div class="field">
  <label>תאריך חדש</label>
  <input id="postponeDateInput" type="date" />
</div>

<div class="field">
  <label>שעת התחלה</label>
  <input id="postponeTimeInput" type="time" />
</div>
      <div class="task-actions">
        <button id="postponeOk" class="primary-pill">אישור</button>
        <button class="ghost-pill" data-close-postpone>ביטול</button>
      </div>
    </div>
  </div>

  <!-- ===================== -->
<!-- Conflict Modal -->
<!-- ===================== -->
<div id="conflictModal" class="modal hidden">
  <div class="modal-backdrop"></div>
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">התנגשות ביומן</div>
      <button class="icon-btn" data-close-conflict>✕</button>
    </div>

    <div id="conflictText" class="small-text"></div>

    <div class="task-actions">
      <button id="conflictEditExisting" class="ghost-pill full-width">
        ערוך את האירוע הקיים
      </button>
      <button id="conflictEditNew" class="ghost-pill full-width">
        חזור לעריכת האירוע שלי
      </button>
      <button id="conflictKeepBoth" class="primary-pill full-width">
        השאר ככה
      </button>
    </div>
  </div>
</div>

  <!-- Service Worker (פעם אחת!) -->
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js');
    });
  }
</script>

<!-- Goals Modal -->
<div id="goalsModal" class="modal hidden">
  <div class="modal-backdrop" data-close-goals></div>
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">🎯 ניהול מטרות</div>
      <button class="icon-btn" data-close-goals>✕</button>
    </div>

    <div class="form">
      <div class="field">
        <label>נושא</label>
        <input id="goalTitle" placeholder="לדוגמה: שיעור" />
      </div>

      <div class="field">
        <label>שעות לשבוע</label>
        <input id="goalHours" type="number" min="0" step="0.5" />
      </div>

<div class="field">
  <label>שייך ל</label>
  <select id="goalOwner">
    <option value="binyamin">בנימין</option>
    <option value="nana">ננה</option>
  </select>
</div>
      
      <button id="btnAddGoal" class="primary-pill full-width">
        הוסף מטרה
      </button>
    </div>

    <div id="goalsList" class="list-container" style="margin-top:10px"></div>
  </div>
</div>

<!-- DELETE CONFIRM MODAL -->
<div id="deleteConfirmModal" class="modal hidden">
  <div class="modal-backdrop"></div>

  <div class="modal-content confirm-modal">
    <div class="confirm-title">למחוק מטרה?</div>
    <div class="confirm-text" id="confirmText"></div>

    <div class="confirm-actions">
      <button id="confirmCancel" class="ghost-pill full-width">ביטול</button>
      <button id="confirmOk" class="primary-pill full-width danger">מחיקה</button>
    </div>
  </div>
</div>
  
</body>
</html>

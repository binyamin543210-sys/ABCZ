<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>BNAPP V3.5.1</title>

  <meta name="theme-color" content="#6366f1" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Chart.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Hebcal (browser build) -->
  <script defer src="https://www.hebcal.com/etc/hebcal.js"></script>

  <!-- App -->
  <script type="module" src="app.js"></script>
</head>

<body>
  <!-- Toast -->
  <div id="toast" class="toast hidden">הפעולה בוצעה</div>

  <div id="app">
    <header class="app-header">
      <div class="header-top">
        <button id="btnThemeToggle" class="icon-btn" aria-label="Theme">☀️/🌙</button>
        <div class="app-title">BNAPP V3.5.1</div>
        <button id="btnGihari" class="primary-pill">ג'יחרי</button>
      </div>

      <div class="header-bottom">
        <button id="btnPrevMonth" class="icon-btn">‹</button>
        <div class="month-label">
          <span id="gregMonthLabel"></span>
          <span id="hebrewMonthLabel" class="sub-label"></span>
        </div>
        <button id="btnNextMonth" class="icon-btn">›</button>
      </div>

      <div class="header-row">
        <select id="userSelect" class="pill-select">
          <option value="binyamin">בנימין</option>
          <option value="nana">ננה</option>
          <option value="shared">משותף</option>
        </select>
        <button id="btnToday" class="ghost-pill">היום</button>
        <button id="btnCity" class="ghost-pill">
          עיר: <span id="cityLabel">לא נבחרה</span>
        </button>
      </div>
    </header>

    <main>
      <section id="calendarSection" class="screen active">
        <div class="weekday-row">
          <div>א'</div><div>ב'</div><div>ג'</div><div>ד'</div><div>ה'</div><div>ו'</div><div>ש'</div>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
      </section>

      <section id="tasksSection" class="screen">
        <div class="section-header">
          <h2>משימות</h2>
          <button id="btnAddTask" class="primary-pill">+ משימה</button>
        </div>
        <div class="segmented">
          <button data-filter="undated" class="segmented-btn active">ללא תאריך</button>
          <button data-filter="dated" class="segmented-btn">מתוארכות</button>
          <button data-filter="recurring" class="segmented-btn">חוזרות</button>
        </div>
        <div id="tasksList" class="list-container"></div>
      </section>

      <section id="shoppingSection" class="screen">
        <div class="section-header">
          <h2>רשימת קניות</h2>
        </div>
        <div class="segmented">
          <button data-list="default" class="segmented-btn active">רגיל</button>
          <button data-list="shabbat" class="segmented-btn">קניות לשבת</button>
          <button data-list="pesach" class="segmented-btn">קניות לפסח</button>
          <button data-list="holiday" class="segmented-btn">קניות לחג</button>
        </div>
        <div class="shopping-input-row">
          <input id="shoppingInput" type="text" placeholder="הוסף פריט..." />
          <button id="btnAddShopping" class="primary-pill">+</button>
        </div>
        <ul id="shoppingList" class="list-container"></ul>
      </section>

      <section id="statsSection" class="screen">
        <div class="section-header">
          <h2>סטטיסטיקות</h2>
        </div>
        <div class="card">
          <canvas id="workFreeChart" height="220"></canvas>
        </div>
        <div class="card">
          <canvas id="tasksChart" height="220"></canvas>
        </div>
      </section>

      <section id="settingsSection" class="screen">
        <div class="section-header">
          <h2>הגדרות</h2>
        </div>

        <div class="settings-group">
          <label>עיר:</label>
          <input id="settingsCityInput" type="text" placeholder="Jerusalem,IL" />
          <button id="btnSaveCity" class="primary-pill">שמור עיר</button>
        </div>

        <div class="settings-group">
          <button id="btnToggleHoliday" class="ghost-pill full-width">סמן היום כיום חופש</button>
        </div>

        <div class="settings-group">
          <button id="btnRequestNotifications" class="ghost-pill full-width">אפשר התראות</button>
        </div>
      </section>
    </main>

    <nav class="bottom-nav">
      <button data-target="calendarSection" class="nav-btn active">לוח שנה</button>
      <button data-target="tasksSection" class="nav-btn">משימות</button>
      <button data-target="shoppingSection" class="nav-btn">קניות</button>
      <button data-target="statsSection" class="nav-btn">סטטיסטיקות</button>
      <button data-target="settingsSection" class="nav-btn">הגדרות</button>
    </nav>

    <button id="btnFabAdd" class="fab-btn">+</button>
  </div>

  <!-- Day modal -->
  <div id="dayModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content day-modal">
      <div class="modal-header">
        <div>
          <div class="modal-title">
            <span id="dayModalGreg"></span>
          </div>
          <div class="modal-subtitle">
            <span id="dayModalHeb"></span>
          </div>
        </div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <div id="dayWeatherContainer" class="weather-card hidden">
        <div class="weather-main">
          <div class="weather-emoji" id="dayWeatherEmoji">🌦️</div>
          <div>
            <div class="weather-temp" id="dayWeatherTemp"></div>
            <div class="weather-desc" id="dayWeatherDesc"></div>
          </div>
        </div>
        <div class="weather-extra" id="dayWeatherExtra"></div>
      </div>

      <div class="chip-row" style="margin-bottom:8px;">
        <button id="btnAddFromDay" class="primary-pill full-width">+ הוסף</button>
        <button id="btnToggleDayWeather" class="ghost-pill full-width">מזג אוויר</button>
      </div>

      <div class="auto-blocks" id="dayAutoBlocks"></div>
      <div id="dayEventsContainer" class="list-container"></div>
    </div>
  </div>

  <!-- Edit modal -->
  <div id="editModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">אירוע / משימה</div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <form id="editForm" class="form">
        <div class="grid-2">
          <div class="field">
            <label>תאריך</label>
            <input name="date" type="date" />
          </div>
          <div class="field">
            <label>סוג</label>
            <select name="type">
              <option value="event">אירוע</option>
              <option value="task">משימה</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>בעלות</label>
            <select name="owner">
              <option value="binyamin">בנימין</option>
              <option value="nana">ננה</option>
              <option value="shared">משותף</option>
            </select>
          </div>
          <div class="field">
            <label>דחיפות</label>
            <select name="urgency">
              <option value="none">לא דחוף</option>
              <option value="today">היום</option>
              <option value="week">השבוע</option>
              <option value="month">החודש</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>כותרת</label>
          <input name="title" type="text" required />
        </div>

        <div class="field">
          <label>תיאור</label>
          <textarea name="description" rows="2"></textarea>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>שעת התחלה</label>
            <input name="startTime" type="time" />
          </div>
          <div class="field">
            <label>שעת סיום</label>
            <input name="endTime" type="time" />
          </div>
        </div>

        <div class="grid-2">
          <div class="field">
            <label>משך (דקות)</label>
            <input name="duration" type="number" min="0" />
          </div>
          <div class="field">
            <label>תזכורת (דקות לפני)</label>
            <input name="reminderMinutes" type="number" min="0" />
          </div>
        </div>

        <div class="field">
          <label>כתובת (ל-Waze)</label>
          <input name="address" type="text" />
        </div>

        <div class="grid-2">
          <div class="field">
            <label>חזרתיות</label>
            <select name="recurring">
              <option value="none">ללא</option>
              <option value="weekly">שבועי</option>
              <option value="monthly_greg">חודשי (לועזי)</option>
              <option value="yearly_greg">שנתי (לועזי)</option>
            </select>
          </div>
          <div class="field">
            <label> </label>
            <button id="btnOpenWaze" type="button" class="ghost-pill full-width">פתח Waze</button>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="primary-pill full-width">שמור</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Gihari modal -->
  <div id="gihariModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">ג'יחרי</div>
        <button class="icon-btn" data-close-modal>✕</button>
      </div>

      <div id="gihariSummary" class="gihari-summary"></div>

      <div class="gihari-actions">
        <button id="gihariSuggestNow" class="primary-pill full-width">הצע עכשיו</button>
        <button id="gihariPlaceTasks" class="ghost-pill full-width">שבץ משימות ללא תאריך</button>
        <button id="gihariMicBtn" class="ghost-pill full-width">🎤 דבר</button>
      </div>

      <div id="gihariLog" class="list-container"></div>
    </div>
  </div>

  <!-- Postpone modal -->
  <div id="postponeModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close-postpone></div>
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">דחיית משימה</div>
        <button class="icon-btn" data-close-postpone>✕</button>
      </div>
      <div class="form">
        <div class="field">
          <label>תאריך חדש</label>
          <input id="postponeDateInput" type="date" />
        </div>
        <button id="postponeOk" class="primary-pill full-width" type="button">אישור</button>
      </div>
    </div>
  </div>

  <!-- Service Worker (once) -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js');
      });
    }
  </script>
</body>
</html>
